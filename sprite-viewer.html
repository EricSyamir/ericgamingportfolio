<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sprite Viewer - Debug Tool</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
    
    :root {
      --bg-dark: #0f0f1a;
      --bg-card: rgba(15, 15, 26, 0.95);
      --gold: #ffd700;
      --primary: #667eea;
      --text-light: #e0e0e0;
      --text-muted: #a0a0a0;
      --pixel-font: 'Press Start 2P', monospace;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: var(--bg-dark);
      color: var(--text-light);
      font-family: var(--pixel-font);
      font-size: 8px;
      padding: 20px;
      overflow-x: hidden;
    }

    .header {
      text-align: center;
      margin-bottom: 20px;
      padding: 20px;
      background: var(--bg-card);
      border: 3px solid var(--gold);
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
    }

    .header h1 {
      color: var(--gold);
      font-size: 12px;
      margin-bottom: 10px;
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
    }

    .header p {
      color: var(--text-muted);
      font-size: 6px;
      line-height: 1.6;
    }

    .controls {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
      align-items: center;
      background: var(--bg-card);
      padding: 15px;
      border: 2px solid var(--primary);
      border-radius: 8px;
    }

    .search-box {
      flex: 1;
      min-width: 200px;
      padding: 8px 12px;
      background: rgba(0, 0, 0, 0.5);
      border: 2px solid var(--primary);
      border-radius: 6px;
      color: var(--text-light);
      font-family: var(--pixel-font);
      font-size: 7px;
      outline: none;
    }

    .search-box:focus {
      border-color: var(--gold);
      box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
    }

    .zoom-controls {
      display: flex;
      gap: 5px;
      align-items: center;
    }

    .btn {
      padding: 8px 16px;
      background: rgba(102, 126, 234, 0.3);
      border: 2px solid var(--primary);
      border-radius: 6px;
      color: var(--text-light);
      font-family: var(--pixel-font);
      font-size: 7px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn:hover {
      background: rgba(102, 126, 234, 0.5);
      transform: translateY(-2px);
    }

    .btn.active {
      background: var(--gold);
      border-color: var(--gold);
      color: #000;
    }

    .container {
      display: grid;
      grid-template-columns: 1fr 300px;
      gap: 20px;
    }

    .sprite-grid-container {
      background: var(--bg-card);
      border: 3px solid var(--gold);
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
    }

    .info-bar {
      margin-bottom: 15px;
      padding: 10px;
      background: rgba(0, 0, 0, 0.3);
      border: 2px solid var(--primary);
      border-radius: 6px;
      font-size: 7px;
      color: var(--text-muted);
    }

    .sprite-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(64px, 1fr));
      gap: 10px;
      max-height: calc(100vh - 350px);
      overflow-y: auto;
      padding: 10px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
    }

    .sprite-grid::-webkit-scrollbar {
      width: 8px;
    }

    .sprite-grid::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 4px;
    }

    .sprite-grid::-webkit-scrollbar-thumb {
      background: var(--primary);
      border-radius: 4px;
    }

    .sprite-item {
      position: relative;
      background: rgba(0, 0, 0, 0.5);
      border: 2px solid var(--primary);
      border-radius: 6px;
      padding: 8px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 80px;
    }

    .sprite-item:hover {
      border-color: var(--gold);
      transform: scale(1.05);
      box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
    }

    .sprite-item.selected {
      border-color: var(--gold);
      background: rgba(255, 215, 0, 0.1);
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.7);
    }

    .sprite-item img {
      image-rendering: pixelated;
      image-rendering: -moz-crisp-edges;
      image-rendering: crisp-edges;
      max-width: 100%;
      height: auto;
    }

    .sprite-index {
      margin-top: 5px;
      font-size: 6px;
      color: var(--text-muted);
      text-align: center;
    }

    .preview-panel {
      background: var(--bg-card);
      border: 3px solid var(--gold);
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
      position: sticky;
      top: 20px;
      height: fit-content;
    }

    .preview-panel h2 {
      color: var(--gold);
      font-size: 10px;
      margin-bottom: 15px;
      text-align: center;
    }

    .preview-display {
      background: rgba(0, 0, 0, 0.5);
      border: 2px solid var(--primary);
      border-radius: 8px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 200px;
      margin-bottom: 15px;
    }

    .preview-display img {
      image-rendering: pixelated;
      image-rendering: -moz-crisp-edges;
      image-rendering: crisp-edges;
      max-width: 100%;
      max-height: 300px;
      border: 2px solid var(--gold);
      border-radius: 6px;
    }

    .preview-info {
      background: rgba(0, 0, 0, 0.3);
      border: 2px solid var(--primary);
      border-radius: 6px;
      padding: 15px;
      font-size: 7px;
      line-height: 2;
    }

    .preview-info div {
      margin-bottom: 8px;
    }

    .preview-info strong {
      color: var(--gold);
    }

    .copy-btn {
      margin-top: 10px;
      width: 100%;
      background: linear-gradient(135deg, var(--gold), #ffed4e);
      border: 2px solid #000;
      color: #000;
      font-weight: bold;
    }

    .copy-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(255, 215, 0, 0.5);
    }

    .no-selection {
      text-align: center;
      color: var(--text-muted);
      font-size: 7px;
      padding: 40px 20px;
    }

    @media (max-width: 900px) {
      .container {
        grid-template-columns: 1fr;
      }

      .preview-panel {
        position: static;
      }

      .sprite-grid {
        grid-template-columns: repeat(auto-fill, minmax(48px, 1fr));
        gap: 8px;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>SPRITE VIEWER</h1>
    <p>Click on any sprite to view details and copy its index</p>
  </div>

  <div class="controls">
    <input type="text" id="searchBox" class="search-box" placeholder="Search by index (e.g., 936, 890-900)">
    <div class="zoom-controls">
      <button class="btn" id="zoom1x">1x</button>
      <button class="btn active" id="zoom2x">2x</button>
      <button class="btn" id="zoom3x">3x</button>
      <button class="btn" id="zoom4x">4x</button>
    </div>
  </div>

  <div class="container">
    <div class="sprite-grid-container">
      <div class="info-bar">
        <span>Total Sprites: <strong id="totalSprites">1209</strong></span> | 
        <span>Showing: <strong id="showingCount">1209</strong></span> | 
        <span>Selected: <strong id="selectedIndex">-</strong></span>
      </div>
      <div class="sprite-grid" id="spriteGrid"></div>
    </div>

    <div class="preview-panel">
      <h2>PREVIEW</h2>
      <div class="preview-display" id="previewDisplay">
        <div class="no-selection">Click a sprite to preview</div>
      </div>
      <div class="preview-info" id="previewInfo" style="display: none;">
        <div><strong>Index:</strong> <span id="infoIndex">-</span></div>
        <div><strong>Row:</strong> <span id="infoRow">-</span></div>
        <div><strong>Column:</strong> <span id="infoCol">-</span></div>
        <div><strong>Position:</strong> <span id="infoPos">-</span></div>
        <button class="btn copy-btn" id="copyBtn">COPY INDEX</button>
      </div>
    </div>
  </div>

  <script>
    const SPRITESHEET_COLS = 39;
    const SPRITESHEET_ROWS = 31;
    const TOTAL_SPRITES = SPRITESHEET_COLS * SPRITESHEET_ROWS;
    let SPRITE_SIZE = 16; // Will be calculated from image dimensions

    let selectedIndex = null;
    let currentZoom = 2;
    let filteredSprites = [];

    const spriteGrid = document.getElementById('spriteGrid');
    const previewDisplay = document.getElementById('previewDisplay');
    const previewInfo = document.getElementById('previewInfo');
    const searchBox = document.getElementById('searchBox');
    const selectedIndexSpan = document.getElementById('selectedIndex');
    const showingCountSpan = document.getElementById('showingCount');
    const infoIndex = document.getElementById('infoIndex');
    const infoRow = document.getElementById('infoRow');
    const infoCol = document.getElementById('infoCol');
    const infoPos = document.getElementById('infoPos');
    const copyBtn = document.getElementById('copyBtn');

    // Load spritesheet image
    const spritesheet = new Image();
    spritesheet.crossOrigin = 'anonymous';
    spritesheet.src = './spritesheet.png';
    
    spritesheet.onload = () => {
      // Calculate sprite size from image dimensions
      SPRITE_SIZE = Math.floor(spritesheet.width / SPRITESHEET_COLS);
      renderSprites();
    };

    spritesheet.onerror = () => {
      spriteGrid.innerHTML = '<div style="color: red; padding: 20px; text-align: center;">Error: Could not load spritesheet.png</div>';
    };

    // Calculate sprite position in spritesheet
    function getSpritePosition(index) {
      const row = Math.floor(index / SPRITESHEET_COLS);
      const col = index % SPRITESHEET_COLS;
      return { row, col, x: col * SPRITESHEET_SIZE, y: row * SPRITESHEET_SIZE };
    }

    // Create sprite image from spritesheet
    function createSpriteImage(index, zoom = 1) {
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      const size = SPRITE_SIZE * zoom;
      canvas.width = size;
      canvas.height = size;

      const pos = getSpritePosition(index);
      ctx.imageSmoothingEnabled = false;
      ctx.drawImage(
        spritesheet,
        pos.x, pos.y, SPRITE_SIZE, SPRITE_SIZE,
        0, 0, size, size
      );

      return canvas.toDataURL();
    }

    // Render all sprites
    function renderSprites() {
      spriteGrid.innerHTML = '';
      const spritesToShow = filteredSprites.length > 0 ? filteredSprites : Array.from({ length: TOTAL_SPRITES }, (_, i) => i);
      showingCountSpan.textContent = spritesToShow.length;

      spritesToShow.forEach(index => {
        const spriteItem = document.createElement('div');
        spriteItem.className = 'sprite-item';
        if (selectedIndex === index) {
          spriteItem.classList.add('selected');
        }

        const spriteImg = document.createElement('img');
        spriteImg.src = createSpriteImage(index, currentZoom);
        spriteImg.alt = `Sprite ${index}`;

        const spriteIndex = document.createElement('div');
        spriteIndex.className = 'sprite-index';
        spriteIndex.textContent = index;

        spriteItem.appendChild(spriteImg);
        spriteItem.appendChild(spriteIndex);

        spriteItem.addEventListener('click', () => selectSprite(index));
        spriteGrid.appendChild(spriteItem);
      });
    }

    // Select a sprite
    function selectSprite(index) {
      selectedIndex = index;
      selectedIndexSpan.textContent = index;

      // Update preview
      const previewImg = document.createElement('img');
      previewImg.src = createSpriteImage(index, 4);
      previewImg.alt = `Sprite ${index}`;
      previewDisplay.innerHTML = '';
      previewDisplay.appendChild(previewImg);

      // Update info
      const pos = getSpritePosition(index);
      infoIndex.textContent = index;
      infoRow.textContent = pos.row;
      infoCol.textContent = pos.col;
      infoPos.textContent = `(${pos.x}, ${pos.y})`;
      previewInfo.style.display = 'block';

      // Update selected state in grid
      renderSprites();
      
      // Scroll to selected sprite
      const selectedItem = spriteGrid.querySelector(`.sprite-item:nth-child(${filteredSprites.length > 0 ? filteredSprites.indexOf(index) + 1 : index + 1})`);
      if (selectedItem) {
        selectedItem.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    }

    // Copy index to clipboard
    copyBtn.addEventListener('click', () => {
      if (selectedIndex !== null) {
        navigator.clipboard.writeText(selectedIndex.toString()).then(() => {
          copyBtn.textContent = 'COPIED!';
          setTimeout(() => {
            copyBtn.textContent = 'COPY INDEX';
          }, 2000);
        });
      }
    });

    // Search/filter sprites
    searchBox.addEventListener('input', (e) => {
      const query = e.target.value.trim();
      filteredSprites = [];

      if (query) {
        // Try to parse as range (e.g., "890-900")
        const rangeMatch = query.match(/^(\d+)-(\d+)$/);
        if (rangeMatch) {
          const start = parseInt(rangeMatch[1]);
          const end = parseInt(rangeMatch[2]);
          for (let i = start; i <= end && i < TOTAL_SPRITES; i++) {
            filteredSprites.push(i);
          }
        } else {
          // Single number or partial match
          const num = parseInt(query);
          if (!isNaN(num) && num >= 0 && num < TOTAL_SPRITES) {
            filteredSprites.push(num);
          }
        }
      }

      renderSprites();
    });

    // Zoom controls
    document.getElementById('zoom1x').addEventListener('click', () => setZoom(1));
    document.getElementById('zoom2x').addEventListener('click', () => setZoom(2));
    document.getElementById('zoom3x').addEventListener('click', () => setZoom(3));
    document.getElementById('zoom4x').addEventListener('click', () => setZoom(4));

    function setZoom(zoom) {
      currentZoom = zoom;
      document.querySelectorAll('.zoom-controls .btn').forEach(btn => {
        btn.classList.remove('active');
      });
      document.getElementById(`zoom${zoom}x`).classList.add('active');
      renderSprites();
      if (selectedIndex !== null) {
        selectSprite(selectedIndex);
      }
    }

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (selectedIndex === null) return;

      const spritesToShow = filteredSprites.length > 0 ? filteredSprites : Array.from({ length: TOTAL_SPRITES }, (_, i) => i);
      const currentPos = spritesToShow.indexOf(selectedIndex);

      if (e.key === 'ArrowRight' && currentPos < spritesToShow.length - 1) {
        selectSprite(spritesToShow[currentPos + 1]);
      } else if (e.key === 'ArrowLeft' && currentPos > 0) {
        selectSprite(spritesToShow[currentPos - 1]);
      } else if (e.key === 'ArrowDown') {
        const nextIndex = selectedIndex + SPRITESHEET_COLS;
        if (nextIndex < TOTAL_SPRITES) {
          selectSprite(nextIndex);
        }
      } else if (e.key === 'ArrowUp') {
        const prevIndex = selectedIndex - SPRITESHEET_COLS;
        if (prevIndex >= 0) {
          selectSprite(prevIndex);
        }
      }
    });
  </script>
</body>
</html>

